schema: '2.0'
stages:
  import-musicbrainz:
    cmd: python ingest.py --musicbrainz
    deps:
    - path: source/musicbrainz/artist.tar.xz
      hash: md5
      md5: 1d24ebd7242722c349e34bbbc9cb9bc4
      size: 1232899396
    - path: source/musicbrainz/recording.tar.xz
      hash: md5
      md5: 4d60aab2b5d27ad15a1d81b154f61b17
      size: 39490704
    - path: sql/mb_artist.sql
      hash: md5
      md5: b2391156d371ec0ab87e42e1b3815524
      size: 181
    - path: sql/mb_recording.sql
      hash: md5
      md5: a977cd15b868032905db53dafc043590
      size: 164
    outs:
    - path: data/musicbrainz.db
      hash: md5
      md5: 215df73d559d91bb04c5d965fe25a673
      size: 1055404032
  import-mlhd:
    cmd: python ingest.py --mlhd --use-mapping
    deps:
    - path: musicdata/layout.py
      hash: md5
      md5: 95f0e77f860147cd977efcb62f99c3e1
      size: 170
    - path: musicdata/mlhd.py
      hash: md5
      md5: c70320f1891bd831a70bffe2cb434e4c
      size: 10942
    - path: musicdata/params.py
      hash: md5
      md5: eb430f047fd1aa7ae785112dee906353
      size: 172
    - path: source/mlhdplus
      hash: md5
      md5: 74c52e5ff2fba58a13bc8bada40a675f.dir
      size: 258484725760
      nfiles: 16
    outs:
    - path: data/mlhd
      hash: md5
      md5: 6bfe198aa971abe8f62524190a0b9170.dir
      size: 141306342264
      nfiles: 1233
    - path: data/mlhd_ids.parquet
      hash: md5
      md5: 0ddbd0a73f94261c2b80b4b6c66e4ab8
      size: 201553795
  prep-mlhd:
    cmd: python prep.py
    deps:
    - path: data/mlhd/
      hash: md5
      md5: 6bfe198aa971abe8f62524190a0b9170.dir
      size: 141306342264
      nfiles: 1233
    - path: data/mlhd_ids.parquet
      hash: md5
      md5: 0ddbd0a73f94261c2b80b4b6c66e4ab8
      size: 201553795
    - path: data/musicbrainz.db
      hash: md5
      md5: 215df73d559d91bb04c5d965fe25a673
      size: 1055404032
    - path: musicdata/layout.py
      hash: md5
      md5: 95f0e77f860147cd977efcb62f99c3e1
      size: 170
    - path: musicdata/mlhd_prep.py
      hash: md5
      md5: 32225b36ca3bcdc558f64f3973883fb8
      size: 5938
    outs:
    - path: data/mlhdv2
      hash: md5
      md5: 32c644f93274da0ee48fc609afdc68d7.dir
      size: 52707736189
      nfiles: 256
  agg-prep-mlhd:
    cmd: python aggprep.py
    deps:
    - path: data/mlhdv2
      hash: md5
      md5: 32c644f93274da0ee48fc609afdc68d7.dir
      size: 52707736189
      nfiles: 256
    - path: musicdata/layout.py
      hash: md5
      md5: 95f0e77f860147cd977efcb62f99c3e1
      size: 170
    - path: musicdata/mlhd_prep_agg.py
      hash: md5
      md5: 12ee8d4c31bf5d95658692e76b8ff328
      size: 991
    outs:
    - path: data/solo-artist-count
      hash: md5
      md5: 41fc28e6a1da818680618e9da4a67d77.dir
      size: 2834985625
      nfiles: 1
